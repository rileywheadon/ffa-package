test_that("Test ams-decomposition.R on data set #1.", {

	# Load dataset 
	df <- load_data("Application_1.csv", clean = FALSE)

	# Test decomposition scenario (1)
	data <- ams.decomposition(df$max, df$year, "10")

	expect_equal(data, c(
    	1654.8837, 3073.7209, 2742.5581, 2061.3953, 2470.2326, 1449.0698, 1007.9070, 2476.7442,
    	1455.5814,  897.4186, 1843.2558, 1522.0930, 1870.9302, 1439.7674, 2198.6047, 2167.4419,
    	1116.2791, 1745.1163,  291.9535,       NaN,       NaN,       NaN,       NaN,       NaN,
    	      NaN, 1015.8140, 1204.6512, 1593.4884, 1932.3256, 1651.1628, 2030.0000, 4758.8372,
    	 898.6744, 1576.5116, 1945.3488, 3594.1860,  973.0233, 1511.8605, 1740.6977, 2369.5349,
    	1768.3721, 5377.2093, 2166.0465, 1654.8837, 1093.7209, 2202.5581, 1651.3953, 2740.2326,
    	1019.0698, 1477.9070, 1516.7442, 1525.5814, 3434.4186, 1663.2558, 1552.0930, 1210.9302,
    	2919.7674, 1448.6047, 4387.4419, 3286.2791, 1755.1163, 2433.9535, 1702.7907, 1541.6279,
    	2250.4651, 2199.3023, 2138.1395, 4096.9767, 1145.8140, 3324.6512, 1453.4884, 1292.3256,
    	1351.1628, 4300.0000, 1938.8372, 1477.6744, 2216.5116, 2585.3488, 1764.1860,  913.0233,
    	 810.8605, 1530.6977, 2049.5349, 2458.3721, 2767.2093, 1496.0465, 1984.8837, 1393.7209,
    	2462.5581, 1011.3953, 1250.2326, 1679.0698, 1887.9070, 1036.7442, 2165.5814, 1374.4186,
    	1333.2558,  778.0930, 3680.9302, 2999.7674, 2048.6047, 1237.4419,  886.2791, 1085.1163,
    	2163.9535, 1722.7907, 2571.6279, 3760.4651), tol = 1e-4)

	# Test decomposition scenario (3)
	data <- ams.decomposition(df$max, df$year, "11")

	expect_equal(data, c(
    	1670.0000, 3087.7343, 2756.1258, 2076.2101, 2483.3330, 1466.7036, 1028.6490, 2488.2982,
    	1474.6627,  921.9254, 1859.5145, 1541.9279, 1887.0894, 1461.4965, 2210.4513, 2179.5149,
    	1144.5595, 1763.7873,  336.2973,       NaN,       NaN,       NaN,       NaN,       NaN,
    	      NaN, 1053.7491, 1238.7328, 1618.1473, 1948.1802, 1674.8977, 2043.0858, 4690.5229,
    	 946.4030, 1603.7617, 1960.9320, 3554.5094, 1022.1269, 1542.8160, 1763.7609, 2369.3997,
    	1790.7824, 5258.8885, 2172.9163, 1682.4572, 1145.0187, 2207.3053, 1679.9521, 2720.6105,
    	1076.8972, 1515.3340, 1552.7715, 1561.5817, 3377.2622, 1693.1639, 1587.9127, 1264.7475,
    	2884.4034, 1491.0462, 4270.5988, 3228.1142, 1781.7129, 2422.0332, 1732.7767, 1581.3103,
    	2248.2380, 2199.9169, 2142.2995, 3979.0174, 1212.3123, 3252.4048, 1501.4409, 1351.3106,
    	1406.8060, 4157.2309, 1955.3770, 1526.1369, 2213.6385, 2556.1062, 1793.3289, 1004.1317,
    	 910.3647, 1577.6896, 2057.8975, 2435.5861, 2720.2685, 1547.1824, 1998.0200, 1453.7590,
    	2437.3363, 1103.3703, 1323.4427, 1717.3979, 1909.0195, 1129.7428, 2163.1508, 1439.8929,
    	1402.7900,  896.8307, 3543.6782, 2921.9574, 2055.7023, 1318.2701,  999.9359, 1181.2335,
    	2159.9828, 1760.2327, 2528.5712, 3602.9364
	), tol = 1e-4)

})

test_that("Test ams-decomposition.R on data set #2.", {

	# Load dataset 
	df <- load_data("Application_2.csv", clean = FALSE)

	# Test decomposition scenario (1)
	data <- ams.decomposition(df$max, df$year, "10")

	expect_equal(data, c(
		2350.0000, 1693.8571, 1757.7143, 1511.5714, 2245.4286, 2709.2857, 2613.1429, 2067.0000,
   	    1800.8571, 1664.7143, 2718.5714, 1602.4286, 1716.2857, 1280.1429, 2514.0000, 2137.8571,
   	    1164.7143, 1995.5714, 2609.4286, 2843.2857, 3817.1429, 2751.0000, 2894.8571, 2828.7143,
   	    2352.5714, 2586.4286, 3250.2857, 2884.1429, 3618.0000, 2731.8571, 2715.7143, 3069.5714,
   	    2633.4286, 3767.2857, 2271.1429, 2295.0000, 3138.8571, 2652.7143, 2996.5714, 3320.4286,
   	    2684.2857, 3158.1429, 2442.0000, 3145.8571, 2309.7143, 1433.5714, 2197.4286, 1781.2857,
   	    1925.1429, 1370.0000, 1522.8571, 1468.7143, 1770.5714, 1994.4286, 2028.2857, 1679.1429,
   	    1487.0000, 1819.8571, 1797.7143, 1726.5714, 1579.4286, 1799.2857, 1959.1429, 2393.0000,
   	    1679.8571, 1704.7143, 1653.5714, 2168.4286, 2532.2857, 2696.1429, 2300.0000, 2383.8571,
   	    2027.7143, 1484.5714, 2445.4286, 2027.2857, 1925.1429, 2013.0000, 2860.8571, 2134.7143,
   	    2728.5714, 2162.4286, 2486.2857, 2610.1429, 2874.0000, 2737.8571, 2571.7143, 2345.5714,
   	    2429.4286, 2563.2857, 2587.1429
	), tol = 1e-4)

	# Test decomposition scenario (3)
	data <- ams.decomposition(df$max, df$year, "11")

	expect_equal(data, c(
    	2350.0000, 1690.5773, 1751.8151, 1498.6257, 2244.2546, 2720.6664, 2623.6603, 2057.9098,
    	1778.4079, 1632.3696, 2742.5110, 1558.5143, 1675.9824, 1203.3399, 2531.5882, 2123.7011,
    	1057.6112, 1964.9736, 2642.8434, 2905.4713, 4000.7547, 2808.7792, 2975.1269, 2903.7819,
    	2360.5864, 2631.2786, 3405.5050, 2983.9391, 3852.6961, 2812.1794, 2796.2245, 3224.3505,
    	2703.2607, 4085.2924, 2264.9610, 2294.1459, 3341.3114, 2740.9865, 3176.4913, 3592.6177,
    	2790.3695, 3402.1754, 2483.9793, 3401.6785, 2313.1509, 1156.2967, 2164.0203, 1605.5847,
    	1794.6532, 1036.3875, 1236.3684, 1153.7763, 1564.7163, 1872.6402, 1917.1690, 1417.8397,
    	1135.7370, 1607.3004, 1569.6501, 1459.5322, 1235.2946, 1554.4112, 1788.5541, 2441.5519,
    	1353.6302, 1384.0578, 1296.9850, 2094.7278, 2667.5992, 2931.7574, 2300.8066, 2436.7264,
    	1855.6792,  955.8431, 2542.9158, 1842.9217, 1665.6547, 1810.0798, 3269.1481, 2012.9803,
    	3054.8711, 2056.7241, 2635.0712, 2862.6052, 3350.6030, 3109.6775, 2807.9488, 2387.0387,
    	2547.5671, 2807.5875, 2859.2859
 	), tol = 1e-4)

})

test_that("Test ams-decomposition.R on data set #3.1.", {

	# Load dataset 
	df <- load_data("Application_3.1.csv", clean = FALSE)

	# Test decomposition scenario (1)
	data <- ams.decomposition(df$max, df$year, "10")

	expect_equal(data, c(
    	314.0000,  230.4882,  264.9765,  175.4647,  233.9529,  216.4412,  238.9294,  312.4176,
    	177.9059,  349.3941,  189.8823,  253.3706,  176.8588,  215.3470,  383.8353,  174.3235,
    	219.8117,  138.3000,  229.7882,  298.2764,  224.7647,  273.2529,  197.7411,  290.2294,
    	322.7176,  281.2058,  209.6941,  232.1823,  161.6705,  234.1588,  192.6470,  219.1352,
    	141.6235,  182.1117,  225.5999,  175.0882,  143.5764,  222.0646,  185.5529,  311.0411,
    	140.5293,  306.0176,  263.5058,  175.9940,  281.4823,  307.9705,  268.4587,  279.9470,
    	175.4352,  214.9234,  236.4117,  206.8999,  291.3882,  209.8764,  209.3646,  272.8529,
    	316.3411,  252.8293,  303.3176,  219.8058,  232.2940,  184.7823,  229.2705,  341.7587,
    	246.2470,  348.7352,  176.2234,  223.7117,  240.1999,  222.6881,  184.1764,  224.6646,
    	262.1528,  227.6411,  191.1293,  256.6175,  197.1058,  350.5940,  184.0822,  282.5705,
    	247.0587,  278.5469,  282.0352,  171.5234,  169.0116,  188.4999,  304.9881,  273.4763,
    	255.9646,  176.4528,  248.9410,  197.4293,  209.9175,  271.4057,  209.8940,  208.3822,
    	213.8704,  215.3587,  345.8469,  211.3351,  191.8234,  187.3116,  228.7998,  382.2881,
    	516.7763,  229.2645,  202.7528,  159.2410,       NaN,  252.2175
	), tol = 1e-4)

	# Test decomposition scenario (3)
	data <- ams.decomposition(df$max, df$year, "11")

	expect_equal(data, c(
    	314.0000,  230.4856,  264.9943,  175.4011,  233.9469,  216.4041,  238.9304,  312.5922,
    	177.7425,  349.7310,  189.7185,  253.4260,  176.6093,  215.2456,  384.5231,  173.9984,
    	219.7109,  137.7241,  229.7355,  298.6612,  224.6720,  273.5005,  197.4377,  290.6331,
    	323.4034,  281.5685,  209.4405,  232.1249,  160.9407,  234.1166,  192.1802,  218.9318,
    	140.5701,  181.4795,  225.4514,  174.3335,  142.4137,  221.8583,  184.8682,  312.0060,
    	139.1942,  306.9624,  263.8649,  175.0777,  282.1288,  309.0390,  268.9304,  280.6136,
    	174.4014,  214.5294,  236.3769,  206.3494,  292.3306,  209.3579,  208.8267,  273.5014,
    	317.8364,  253.1105,  304.6082,  219.4285,  232.1674,  183.6583,  229.0752,  343.9952,
    	246.4186,  351.2002,  174.8110,  223.3721,  240.2410,  222.3138,  182.8680,  224.3275,
    	262.7412,  227.3692,  189.9217,  257.0878,  196.0214,  353.5756,  182.6178,  283.7749,
    	247.2969,  279.6701,  283.2715,  169.6017,  166.9931,  187.0301,  306.9702,  274.5323,
    	256.4990,  174.5400,  249.2687,  196.1344,  209.0067,  272.4701,  208.9619,  207.3900,
    	213.0506,  214.5802,  349.5076,  210.4015,  190.2009,  185.5137,  228.4573,  387.4499,
    	526.8647,  228.9286,  201.4334,  156.2844,       NaN,  252.7417
	), tol = 1e-4)

})

test_that("Test ams-decomposition.R on data set #3.2.", {

	# Load dataset 
	df <- load_data("Application_3.2.csv", clean = FALSE)

	# Test decomposition scenario (1)
	data <- ams.decomposition(df$max, df$year, "10")

	expect_equal(data, c(
         62.9000,   74.3630,   78.7259,   34.6889,   61.7519,   65.0149,   52.9778,   45.2408,
         44.8038,   82.8668,   84.7297,   73.4927,   86.4557,   66.2187,   64.5816,   58.8446,
         58.4076,   50.3706,   63.5335,   44.3965,   63.7595,   33.1225,   50.1854,   69.3484,
         61.0114,   94.2744,   81.9373,   91.2003,       NaN,       NaN,       NaN,       NaN,
             NaN,       NaN,   57.9411,   70.8041,   58.7671,   50.7300,   79.7930,   44.2560,
         48.0190,   67.9819,   47.4449,   54.4079,   87.9709,   79.9338,   67.8968,   53.2598,
         65.0228,  100.2857,   40.4487,  101.0117,   86.0747,   60.7376,   34.5006,   51.3636,
         85.1266,  110.1895,   56.0525,   83.9155,   66.9785,   56.9414,   56.5044,   71.0674,
         66.9304,   48.2933,   88.8563,  122.8193,   55.9823,   47.2452,   49.4082,   37.7712,
    	113.1341,   38.2971,   82.5601,   42.5231,   97.5860,   43.2490,   50.8120,   70.2750,
        150.0379,   33.3009,   52.9639,   91.6269,   64.8898,   88.3528,   52.8158,   38.0788,
         54.3417,   58.3047,   83.4677,   59.1307,   72.5936,   44.8566,   85.1196
	), tol = 1e-4)

	# Test decomposition scenario (3)
	data <- ams.decomposition(df$max, df$year, "11")

	expect_equal(data, c(
    	62.9000,   74.1858,   78.1964,   36.6183,   62.0988,   65.1188,   54.4945,   48.0026,
    	47.9664,   80.1079,   81.3854,   72.0551,   82.2230,   66.1859,   64.9302,   60.6274,
    	60.3917,   54.6209,   64.2493,   50.7521,   64.4619,   43.4812,   55.3403,   68.2524,
    	62.7510,   84.3145,   76.1911,   81.8793,       NaN,       NaN,       NaN,       NaN,
    	    NaN,       NaN,   61.4049,   68.7534,   61.9814,   57.5855,   73.5699,   54.2892,
    	56.4351,   67.0789,   56.3552,   60.0556,   77.2394,   73.0627,   66.9815,   59.7483,
    	65.5588,   82.5994,   53.8220,   82.6014,   75.4377,   63.5984,   51.5834,   59.3886,
    	74.6431,   85.7251,   61.6504,   73.8685,   66.4634,   62.1558,   62.0064,   68.1737,
    	66.4290,   58.7226,   75.4041,   89.1102,   62.0106,   58.5605,   59.4808,   54.9744,
    	84.3670,   55.3640,   72.3739,   57.1433,   77.9201,   57.5595,   60.4259,   67.6132,
    	96.6379,   54.2350,   61.3737,   75.1572,   65.6538,   73.8719,   61.4648,   56.4174,
    	62.0559,   63.4321,   71.9372,   63.7471,   68.2382,   59.0710,   72.3105
	), tol = 1e-4)

})

test_that("Test ams-decomposition.R on data set #3.3.", {

	# Load dataset 
	df <- load_data("Application_3.3.csv", clean = FALSE)

	# Test decomposition scenario (1)
	data <- ams.decomposition(df$max, df$year, "10")

	expect_equal(data, c(
    	45.2427,   47.9388,   39.9348,   51.3309,   42.3270,   43.7230,   93.4191,   38.3152,
    	34.8112,   30.2773,   44.4033,   46.2994,   45.1955,   43.8915,   44.1876,   42.0836,
    	40.2797,   29.0758,   24.3218,   38.6679,   52.0639,   37.2600,   33.5561,   40.5521,
    	45.3482,   33.8442,   55.9403,   49.5364,   41.8324,   48.4285,   37.7245,   34.9206,
    	43.3167,   40.0127,   56.4088,   44.3048,   66.9009,   65.0970,   39.4930,   52.0891,
    	34.5852,   17.6812,   36.1773,   43.6733,   19.4694,   31.8655,   49.5615,   53.3576,
    	32.8536,   46.0497,   63.2458,   27.1418,   62.4379,   60.5339,   45.4300,   30.0261,
    	78.0221,   18.7182,   29.3142,   59.6103,   57.1064,   61.5024,   55.3985,   25.8945,
    	49.8906,   19.6867,   11.1827,   41.3788,   66.3748,   50.5709,   16.9670,   54.8630,
    	27.7591,   43.6552,   61.5512,   71.5473,   34.7433,   50.7394,   48.8355,    7.8315,
    	44.2276,    5.5236,   33.7197,   42.6158,   56.8118,   17.4079,   39.2039,    1.0000,
    	29.8961,   46.4921,   57.5882,   51.9842,   42.9803,   26.5764,   55.4724,   63.4685,
    	51.4645
	), tol = 1e-4)

	# Test decomposition scenario (3)
	data <- ams.decomposition(df$max, df$year, "11")

	expect_equal(data, c(
    	23.2789,   25.9098,   18.0413,   29.0514,   20.3843,   21.7016,   67.8552,   16.7158,
    	13.5834,    9.5987,   22.2540,   23.9005,   22.9088,   21.7672,   22.0079,   20.2289,
    	18.7366,    9.5503,    5.8004,   17.5027,   28.2102,   16.4585,   13.6092,   19.0896,
    	22.7786,   14.0362,   30.6956,   25.8378,   20.1134,   24.9352,   17.1548,   15.1785,
    	21.1924,   18.8634,   30.3182,   21.8652,   37.3429,   35.9739,   18.5965,   27.0278,
    	15.3835,    4.3282,   16.5103,   21.3871,    5.8773,   13.8748,   25.0843,   27.4237,
    	14.6521,   22.8220,   33.3074,   11.3335,   32.6298,   31.4036,   22.3786,   13.3126,
    	41.3698,    6.8747,   13.0680,   30.4136,   28.9255,   31.3399,   27.8559,   11.4450,
    	24.7239,    8.1809,    3.6505,   20.0527,   33.4457,   24.9527,    7.1690,   27.1499,
    	12.9768,   21.2612,   30.4661,   35.5127,   16.7264,   24.8240,   23.8437,    3.3971,
    	21.5242,    2.4802,   16.3783,   20.7277,   27.5825,    8.6316,   19.1016,    1.0000,
    	14.7358,   22.5460,   27.7024,   25.0676,   20.8992,   13.3939,   26.5799,   30.1625,
    	24.7116
   	), tol = 1e-4)

})
