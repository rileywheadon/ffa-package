<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> • ffaframework</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffaframework</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/trend-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/trend-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/stationary-ffa.html">Stationary FFA</a></li>
    <li><a class="dropdown-item" href="../articles/non-stationary-ffa.html">Nonstationary FFA</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-wiki" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Wiki</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-wiki">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/eda-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/eda-change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/ffa-introduction.html">FFA Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/probability-distributions.html">Probability Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/model-selection.html">Model Selection</a></li>
    <li><a class="dropdown-item" href="../articles/parameter-estimation.html">Parameter Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/uncertainty-quantification.html">Uncertainty Quantification</a></li>
    <li><a class="dropdown-item" href="../articles/model-assessment.html">Model Assessment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/matlab-version.html">MATLAB Version</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rileywheadon/ffa-package/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rileywheadon/ffa-package/blob/master/vignettes/articles/model-selection.Rmd" class="external-link"><code>vignettes/articles/model-selection.Rmd</code></a></small>
      <div class="d-none name"><code>model-selection.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="model-selection">Model Selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h2>
<p>This module selects a statistical model for S-FFA or NS-FFA based on
the annual maximum series.</p>
<ul>
<li>
<strong>S-FFA</strong>: A time-invariant probability distribution is
selected from the candidate distributions.</li>
<li>
<strong>NS-FFA</strong>: A distribution is chosen along with a
nonstationary structure to capture its evolution over time. In piecewise
NS-FFA, the series is segmented into subperiods, each modelled with
either time-invariant or time-varying distributions.</li>
</ul>
<p>The framework uses the <strong>L-moment ratio method</strong> to
identify the best-fit distribution family by comparing sample L-moments
with the L-moments of various distribution families.</p>
<p>For NS-FFA, the series is decomposed to isolate its stationary
component following <a href="https://doi.org/10.1016/j.jhydrol.2022.128186" class="external-link">Vidrio-Sahagún and
He (2022)</a>. This decomposed sample is then used for distribution
selection, as in S-FFA.</p>
<div class="section level3">
<h3 id="an-introduction-to-l-moments">An Introduction to L-Moments<a class="anchor" aria-label="anchor" href="#an-introduction-to-l-moments"></a>
</h3>
<p><strong>Definition 1</strong>: The <strong><span class="math inline">\(k\)</span>-th Order Statistic</strong> of a
statistical sample is its <span class="math inline">\(k\)</span>-th
smallest value.</p>
<p><strong>Definition 2</strong>: The <strong><span class="math inline">\(r\)</span>-th Population L-moment</strong> <span class="math inline">\(\lambda_{r}\)</span> is a linear combination of
the expectation of the order statistics. Let <span class="math inline">\(X_{k:n}\)</span> be the <span class="math inline">\(k\)</span>-th order statistic from a sample of
size <span class="math inline">\(n\)</span>. Then,</p>
<p><span class="math display">\[
\lambda_{r} = \frac{1}{r} \sum_{k=0}^{r-1} (-1)^{k} \binom{r-1}{k}
\mathbb{E}[X_{r-k:r}]
\]</span></p>
<p><strong>Definition 3</strong>: A <strong>Probability Weighted
Moment</strong> (PWM) encodes information about a value’s position on
the cumulative distribution function. The <span class="math inline">\(r\)</span>-th PWM, denoted <span class="math inline">\(\beta_{r}\)</span>, is:</p>
<p><span class="math display">\[
\beta_{r} = \mathbb{E}[X \cdot  F(X)^{r}]
\]</span></p>
<p>For an ordered sample <span class="math inline">\(x_{1:n}
\leq  \dots  \leq  x_{n:n}\)</span>, the sample PWM is often estimated
as:</p>
<p><span class="math display">\[
b_{r} = \frac{1}{n} \sum_{i=1}^{r} x_{i:n} \left(\frac{i-1}{n-1}\right)
^{r}
\]</span></p>
<div class="section level4">
<h4 id="sample-l-moments-from-pwms-and-l-moment-ratios">Sample L-Moments (from PWMs) and L-Moment Ratios<a class="anchor" aria-label="anchor" href="#sample-l-moments-from-pwms-and-l-moment-ratios"></a>
</h4>
<p>The first four sample L-moments can be computed as linear
combinations of the PWMs:</p>
<p><span class="math display">\[
\begin{aligned}
l_{1} &amp;= b_{0} \\
l_{2} &amp;= 2b_{1} - b_{0} \\
l_{3} &amp;= 6b_{2} - 6b_{1} + b_{0} \\
l_{4} &amp;= 20b_{3} - 30b_{2} + 12b_{1} - b_{0}
\end{aligned}
\]</span></p>
<p>The L-moments are used to compute the <strong>Sample
L-variance</strong> <span class="math inline">\(t_{2}\)</span>,
<strong>Sample L-skewness</strong> <span class="math inline">\(t_{3}\)</span> and the <strong>Sample
L-kurtosis</strong> <span class="math inline">\(t_{4}\)</span> using the
following formulas:</p>
<p><span class="math display">\[
\begin{aligned}
t_{2} &amp;= l_{2} / l_{1} \\
t_{3} &amp;= l_{3} / l_{2} \\
t_{4} &amp;= l_{4} / l_{2}
\end{aligned}
\]</span></p>
<p>Then, we compare these statistics, specifically the L-skewness and
L-kurtosis to their theoretical values (given <a href="probability-distributions.html">here</a>) using one of three
different metrics to select a distribution.</p>
<p><strong>Note</strong>: Probability distributions with two parameters
have constant L-skewness <span class="math inline">\(\tau_{3}\)</span>
and L-kurtosis <span class="math inline">\(\tau_{4}\)</span> regardless
of their parameters. The L-skewness and L-kurtosis of probability
distributions with three parameters is a function of the shape parameter
<span class="math inline">\(\kappa\)</span>. The notation <span class="math inline">\(\tau_{3}(\kappa)\)</span> and <span class="math inline">\(\tau_{4}(\kappa)\)</span> refers to the L-skewness
and L-kurtosis <em>curves</em> for three parameter distributions.</p>
</div>
<div class="section level4">
<h4 id="example-plot">Example Plot<a class="anchor" aria-label="anchor" href="#example-plot"></a>
</h4>
<p>Shown below are the L-moment curves of the GEV, GLO, GNO, PE3/LP3,
and WEI distributions as well as the L-moment ratios of the two
parameter distributions GUM and NOR/LNO. This L-moment diagram depicts
the “L-distance” selection metric, which compares the euclidian distance
between the sample and theoretical L-moment ratios. The inset shows that
the GEV distribution (yellow line) has the closest L-moments to the
data.</p>
<p><img src="img/plot-lmom.svg"></p>
</div>
</div>
<div class="section level3">
<h3 id="selection-metrics">Selection Metrics<a class="anchor" aria-label="anchor" href="#selection-metrics"></a>
</h3>
<div class="section level4">
<h4 id="l-distance">1. L-Distance<a class="anchor" aria-label="anchor" href="#l-distance"></a>
</h4>
<p>The Euclidean distance between the sample <span class="math inline">\((t_3, t_4)\)</span> and theoretical <span class="math inline">\((\tau_3, \tau_4)\)</span> for each candidate
distribution. For 3-parameter distributions, this is the
<strong>minimum</strong> distance along their L-moment ratio curve.</p>
</div>
<div class="section level4">
<h4 id="l-kurtosis">2. L-Kurtosis<a class="anchor" aria-label="anchor" href="#l-kurtosis"></a>
</h4>
<p>The L-kurtosis method is only used for three-parameter probability
distributions. First, the shape parameter <span class="math inline">\(\kappa^{*}\)</span> such that <span class="math inline">\(t_{3} = \tau _{3}(\kappa ^{*})\)</span> is
identified. Then, the difference between the sample L-kurtosis and the
theoretical L-kurtosis is computed using the metric <span class="math inline">\(|\tau_{4}(\kappa ^{*}) - t_{4} |\)</span>.</p>
</div>
<div class="section level4">
<h4 id="z-statistic">3. Z-statistic<a class="anchor" aria-label="anchor" href="#z-statistic"></a>
</h4>
<p>The Z-statistic selection metric is calculated as follows (for
three-parameter distributions):</p>
<ol style="list-style-type: decimal">
<li><p>Fit the four-parameter Kappa (K4D) distribution to the
sample.</p></li>
<li><p>Generate <span class="math inline">\(N_{\text{sim}}\)</span>
bootstrap samples from the fitted K4D distribution.</p></li>
<li><p>Calculate the sample L-kurtosis <span class="math inline">\(t_{4}^{[i]}\)</span> of each synthetic
dataset.</p></li>
<li>
<p>Calculate the bias and standard deviation of the bootstrap
distribution:</p>
<p><span class="math display">\[
B_{4} = N_{\text{sim} }^{-1} \sum_{i = 1}^{N_{\text{sim} }}
\left(t_{4}^{[i]} - t_{4}^{s}\right)
\]</span></p>
<p><span class="math display">\[
\sigma _{4} = \left[(N_{\text{sim} } - 1)^{-1} \left\{\sum_{i -
1}^{N_{\text{sim} }} \left(t_{4}^{[i]} - t_{4}^{s}\right)^2 -
N_{\text{sim} } B_{4}^2\right\} \right] ^{\frac{1}{2}}
\]</span></p>
</li>
<li><p>Identify the shape parameter <span class="math inline">\(\kappa^{*}\)</span> such that <span class="math inline">\(t_{3} = \tau _{3}(\kappa ^{*})\)</span>.</p></li>
<li>
<p>Use the bootstrap distribution to compute the Z-statistic for
each distribution:</p>
<p><span class="math display">\[
z = \frac{\tau_{4} (\kappa ^{*}) - t_{4} + B_{4} }{ \sigma _{4}}
\]</span></p>
</li>
<li><p>Choose the distribution with the <em>smallest</em>
Z-statistic.</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="handling-nonstationarity">Handling Nonstationarity<a class="anchor" aria-label="anchor" href="#handling-nonstationarity"></a>
</h3>
<p>When nonstationarity is detected, the annual maximum series is
decomposed before model selection. We consider three nonstationary
scenarios that can be identified in EDA:</p>
<ol style="list-style-type: decimal">
<li>Trend in mean only.</li>
<li>Trend in standard deviation only.</li>
<li>Trend in both mean and standard deviation.</li>
</ol>
<div class="section level4">
<h4 id="decomposition-steps">Decomposition Steps<a class="anchor" aria-label="anchor" href="#decomposition-steps"></a>
</h4>
<div class="section level5">
<h5 id="scenario-1-trend-in-mean">Scenario 1: Trend in mean<a class="anchor" aria-label="anchor" href="#scenario-1-trend-in-mean"></a>
</h5>
<ol style="list-style-type: decimal">
<li>Use <a href="eda-trend-ams-mean.html#sens-trend-estimator">Sen’s Trend
Estimator</a> to approximate the slope <span class="math inline">\(b_1\)</span> and intercept <span class="math inline">\(b_0\)</span>.</li>
<li>Detrend: subtract the linear function <span class="math inline">\((b_{1} \cdot \text{Covariate})\)</span> from the
time series, where the <em>covariate</em> is a time index calculated
using the formula <span class="math inline">\((\text{Years} - 1900) /
100\)</span>.</li>
<li>Ensure positivity: if necessary, shift series by adding a constant
such that <span class="math inline">\(\min(\text{data}) =
1\)</span>.</li>
</ol>
</div>
<div class="section level5">
<h5 id="scenario-2-trend-in-standard-deviation">Scenario 2: Trend in standard deviation<a class="anchor" aria-label="anchor" href="#scenario-2-trend-in-standard-deviation"></a>
</h5>
<ol style="list-style-type: decimal">
<li><p>Generate a time series of standard deviations using the moving
windows method.</p></li>
<li><p>Use <a href="eda-trend-ams-variability.html#sens-trend-estimator">Sen’s Trend
Estimator</a> to identify the slope <span class="math inline">\(c_{1}\)</span> and intercept <span class="math inline">\(c_{0}\)</span> of the trend in the standard
deviations.</p></li>
<li>
<p>Normalize the data to have mean <span class="math inline">\(0\)</span>, then divide out the scale factor <span class="math inline">\(g_{t}\)</span>.</p>
<p><span class="math display">\[
g_{t} = \frac{(c_{1} \cdot  \text{Covariate} ) + c_{0}}{c_{0}}
\]</span></p>
</li>
<li><p>Add back the long-term mean <span class="math inline">\(\mu\)</span>, and then ensure positivity as in
Scenario 1.</p></li>
</ol>
</div>
<div class="section level5">
<h5 id="scenario-3-trend-in-both-mean-and-standard-deviation">Scenario 3: Trend in both mean and standard deviation<a class="anchor" aria-label="anchor" href="#scenario-3-trend-in-both-mean-and-standard-deviation"></a>
</h5>
<ol style="list-style-type: decimal">
<li>Remove the linear trend in mean exactly as in Scenario 1.</li>
<li>On that detrended series, generate a rolling‐window STD series and
fit its trend.</li>
<li>Divide the detrended data by the time-varying scale factor <span class="math inline">\(g_{t}\)</span> (as in Scenario 2).</li>
<li>Shift to preserve the series mean and ensure positivity.</li>
</ol>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Riley Wheadon, Cuauhtémoc Vidrio-Sahagún, Alain Pietroniro, Jianxun He.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
