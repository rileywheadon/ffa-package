<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Change Point Detection â€¢ ffaframework</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Change Point Detection">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffaframework</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/trend-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/trend-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/stationary-ffa.html">Stationary FFA</a></li>
    <li><a class="dropdown-item" href="../articles/non-stationary-ffa.html">Nonstationary FFA</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-wiki" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Wiki</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-wiki">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/eda-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/eda-change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/ffa-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-probability-distributions.html">Probability Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-model-selection.html">Model Selection</a></li>
    <li><a class="dropdown-item" href="../articles/parameter-estimation.html">Parameter Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-uncertainty-quantification.html">Uncertainty Quantification</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-model-assessment.html">Model Assessment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/matlab-version.html">MATLAB Version</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rileywheadon/ffa-package/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Change Point Detection</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rileywheadon/ffa-package/blob/master/vignettes/change-points.Rmd" class="external-link"><code>vignettes/change-points.Rmd</code></a></small>
      <div class="d-none name"><code>change-points.Rmd</code></div>
    </div>

    
    
<p>A change point is an abrupt shift or a temporal pattern switch (e.g.,
beginning of a trend) in a time series. In FFA, change points indicate
inhomogeneous periods, meaning a single model may not represent the
entire record adequately. Instead, piecewise analysis should be applied
to each homogeneous sub-period. The FFA framework provides two
statistical tests for change point detection:</p>
<ul>
<li>The Pettitt test, for sudden changes in the mean.</li>
<li>The Mann-Kendall-Sneyers (MKS) test, for detecting changes in
trend.</li>
</ul>
<p>This vignette will demonstrate how these statistical tests can be
used together to robustly identify change points.</p>
<div class="section level2">
<h2 id="case-study">Case Study<a class="anchor" aria-label="anchor" href="#case-study"></a>
</h2>
<p>This vignette will explore the Kootenai River at Porthill (08NH021)
station, located on the border of British Columbia and Idaho. The
station is located downstream of the Libby Dam, which finished
construction in 1972. Data for this station is provided as
<code>CAN-08NH021.csv</code> in the <code>ffaframework</code>
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rileywheadon.github.io/ffa-docs/" class="external-link">ffaframework</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_local.html">data_local</a></span><span class="op">(</span><span class="st">"CAN-08NH021.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year  max</span></span>
<span><span class="co">#&gt; 1 1928 2350</span></span>
<span><span class="co">#&gt; 2 1929 1680</span></span>
<span><span class="co">#&gt; 3 1930 1730</span></span>
<span><span class="co">#&gt; 4 1931 1470</span></span>
<span><span class="co">#&gt; 5 1932 2190</span></span>
<span><span class="co">#&gt; 6 1933 2640</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_ams_data.html">plot_ams_data</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">max</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span>, title <span class="op">=</span> <span class="st">"Kootenai River at Porthill (08NH021)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="change-points_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="the-pettitt-test">The Pettitt Test<a class="anchor" aria-label="anchor" href="#the-pettitt-test"></a>
</h2>
<p>This rank-based test detects a single abrupt change in the median of
a time series. The null hypothesis assumes no change point. Use the
<code>eda_pettitt_test</code> function to perform the test. It requires
two arguments:</p>
<ul>
<li>
<code>data</code>: the annual maximum series (AMS)</li>
<li>
<code>years</code>: corresponding numeric vector of years</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pettitt_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pettitt_test.html">eda_pettitt_test</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">max</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pettitt_test</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pettitt_test</span><span class="op">$</span><span class="va">change_year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1972</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_pettitt_test.html">plot_pettitt_test</a></span><span class="op">(</span><span class="va">pettitt_test</span><span class="op">)</span></span></code></pre></div>
<p><img src="change-points_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><strong>Conclusion</strong>: A p-value of &lt;0.001 provides strong
evidence of a change point in the year 1972.</p>
</div>
<div class="section level2">
<h2 id="the-mks-test">The MKS Test<a class="anchor" aria-label="anchor" href="#the-mks-test"></a>
</h2>
<p>The Mann-Kendall-Sneyers (MKS) test identifies trend changes in the
data.</p>
<p>Use <code>eda_mks_test</code> with the same arguments as above.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mks_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_mks_test.html">eda_mks_test</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">max</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mks_test</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.01495225</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mks_test</span><span class="op">$</span><span class="va">change_df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1960 1985</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_mks_test.html">plot_mks_test</a></span><span class="op">(</span><span class="va">mks_test</span><span class="op">)</span></span></code></pre></div>
<p><img src="change-points_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><strong>Conclusion</strong>: At a p-value of 0.015, there is evidence
of trend changes in 1960 and 1985.</p>
<p><strong>Note</strong>: Since the MKS test can identify multiple
change points, the reported p-value is determined using the <em>most
significant</em> change point.</p>
</div>
<div class="section level2">
<h2 id="interpreting-and-selecting-change-points">Interpreting and Selecting Change Points<a class="anchor" aria-label="anchor" href="#interpreting-and-selecting-change-points"></a>
</h2>
<p>In this example, the Pettitt and MKS tests both suggest structural
changes in the time series.</p>
<p>Consider the following guidelines when choosing where to split the
data:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Incorporate domain knowledge and case-specific
understanding</strong>. In this example, we know that a water regulation
structure was built in 1972 (the Libby dam). This supports the results
of the Pettitt test.</li>
<li>
<strong>Avoid overpartitioning</strong>. The Pettitt and MKS tests
operate independently and may detect multiple change points. To minimize
sample size issues and reduce uncertainty, retain only significant
change points with physical justification.</li>
<li>
<strong>Prioritize based on p-value</strong>. Lower p-values
indicate stronger evidence and should be given more weight.</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Riley Wheadon, CuauhtÃ©moc Vidrio-SahagÃºn, Alain Pietroniro, Jianxun He.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
