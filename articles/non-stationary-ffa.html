<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Nonstationary FFA • ffaframework</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nonstationary FFA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffaframework</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/trend-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/trend-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/stationary-ffa.html">Stationary FFA</a></li>
    <li><a class="dropdown-item" href="../articles/non-stationary-ffa.html">Nonstationary FFA</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-wiki" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Wiki</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-wiki">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/eda-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/eda-change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/ffa-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-probability-distributions.html">Probability Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-model-selection.html">Model Selection</a></li>
    <li><a class="dropdown-item" href="../articles/parameter-estimation.html">Parameter Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-uncertainty-quantification.html">Uncertainty Quantification</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-model-assessment.html">Model Assessment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/matlab-version.html">MATLAB Version</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rileywheadon/ffa-package/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Nonstationary FFA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rileywheadon/ffa-package/blob/master/vignettes/non-stationary-ffa.Rmd" class="external-link"><code>vignettes/non-stationary-ffa.Rmd</code></a></small>
      <div class="d-none name"><code>non-stationary-ffa.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates how to use the <code>ffaframework</code>
package to perform flood frequency analysis under the assumption of
nonstationarity (NS-FFA). Readers unfamiliar with stationary FFA
workflows should first consult the <em>Stationary FFA</em> vignette.</p>
<p>The framework supports three forms of nonstationarity, modeled as
linear trends in the distribution parameters:</p>
<ol style="list-style-type: decimal">
<li>A linear trend in the location parameter.</li>
<li>A linear trend in the scale parameter.</li>
<li>A linear trend in both the location and scale parameters.</li>
</ol>
<p>The shape parameter is treated as a constant due to difficulties in
estimation caused by sample size limitations.</p>
<div class="section level2">
<h2 id="case-study">Case Study<a class="anchor" aria-label="anchor" href="#case-study"></a>
</h2>
<p>This vignette will explore data from the Bow River at Banff
(05BB001), a station in the Reference Hydrometric Basin Network. The
station is unregulated, which suggests that trends in annual maxima are
caused by changes in climate as opposed to changes in land use or cover.
Data for this station is provided as <code>CAN-05BB001.csv</code> in the
<code>ffaframework</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rileywheadon.github.io/ffa-package/">ffaframework</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_local.html">data_local</a></span><span class="op">(</span><span class="st">"CAN-05BB001.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year max</span></span>
<span><span class="co">#&gt; 1 1909 314</span></span>
<span><span class="co">#&gt; 2 1910 230</span></span>
<span><span class="co">#&gt; 3 1911 264</span></span>
<span><span class="co">#&gt; 4 1912 174</span></span>
<span><span class="co">#&gt; 5 1913 232</span></span>
<span><span class="co">#&gt; 6 1914 214</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_ams_data.html">plot_ams_data</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">max</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span>, title <span class="op">=</span> <span class="st">"Bow River at Banff (05BB001)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-stationary-ffa_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="the-ns_structure-list">The <code>ns_structure</code> List<a class="anchor" aria-label="anchor" href="#the-ns_structure-list"></a>
</h3>
<p>This vignette assumes a scenario where a trend in the mean has been
identified. To specify a trend in one or more distribution parameters,
create a <code>ns_structure</code> (nonstationary model structure) list
containing the boolean items <code>location</code> and
<code>scale</code>. Setting these items to <code>TRUE</code> adds a
trend to the location/scale parameter respectively.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ns_structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: For guidance on trend detection, refer to the
<em>Trend Identification</em> vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="distribution-selection">Distribution Selection<a class="anchor" aria-label="anchor" href="#distribution-selection"></a>
</h2>
<p>L-moment-based distribution selection remains applicable under
nonstationarity, but requires dataset decomposition (detrending) prior
to analysis. The <code>select_*</code> methods do this automatically
(using the <code>data_decomposition</code> method) if the
<code>ns_years</code> and <code>ns_structure</code> arguments are
supplied.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_ldistance.html">select_ldistance</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">max</span>,</span>
<span>    ns_years <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>    ns_structure <span class="op">=</span> <span class="va">ns_structure</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">selection</span><span class="op">$</span><span class="va">recommendation</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GNO"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_lmom_diagram.html">plot_lmom_diagram</a></span><span class="op">(</span><span class="va">selection</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-stationary-ffa_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><strong>Note</strong>: The sample and log-sample points on the
L-moment diagram are based on the detrended data.</p>
<p><strong>Conclusion</strong>: The generalized normal (GNO)
distribution is the best-fit distribution for the sample.</p>
</div>
<div class="section level2">
<h2 id="parameter-estimation">Parameter Estimation<a class="anchor" aria-label="anchor" href="#parameter-estimation"></a>
</h2>
<p>Because L-moments parameter estimation requires stationarity, we will
use maximum likelihood estimation for this nonstationary model. The
<code>fit_mle</code> function implements maximum likelihood estimation
for both stationary and nonstationary distributions. It has two required
arguments:</p>
<ul>
<li>
<code>data</code>: The annual maximum series observations.</li>
<li>
<code>model</code>: A three-letter code corresponding to a
probability distribution (ex. <code>"GNO"</code>).</li>
</ul>
<p>Since a nonstationary model is used, two additional arguments are
required:</p>
<ul>
<li>
<code>ns_years</code>: The corresponding vector of years for the
observations in <code>data</code>.</li>
<li>
<code>ns_structure</code>: The nonstationary <code>structure</code>
object described above.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mle.html">fit_mle</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">max</span>,</span>
<span>    <span class="st">"GNO"</span>,</span>
<span>    ns_years <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>    ns_structure <span class="op">=</span> <span class="va">ns_structure</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 224.0496619 -35.5153685  54.6324886  -0.3689085</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">mll</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -590.7329</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_nsffa_fit.html">plot_nsffa_fit</a></span><span class="op">(</span><span class="va">fit</span>, slices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1915</span>, <span class="fl">2015</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-stationary-ffa_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><strong>Note</strong>: The fitted parameters are: <span class="math inline">\((\mu_0, \mu_1, \sigma, \kappa)\)</span>, where the
time-dependent location is modeled as <span class="math inline">\(\mu(t)
= \mu_0 + \mu_1 t\)</span>. The covariate <span class="math inline">\(t\)</span> is a linear function of the years:
<span class="math inline">\((\text{years} - 1900) / 100\)</span>.</p>
</div>
<div class="section level2">
<h2 id="uncertainty-quantification">Uncertainty Quantification<a class="anchor" aria-label="anchor" href="#uncertainty-quantification"></a>
</h2>
<p>Uncertainty quantification is an important step in NS-FFA as well as
S-FFA. In addition to the parametric bootstrap, the framework implements
the regula-falsi profile likelihood (RFPL) method for MLE. The
<code>uncertainty_rfpl</code> method has two required arguments:</p>
<ul>
<li>
<code>data</code>: The annual maximum series observations.</li>
<li>
<code>model</code>: A three-letter code corresponding to a
probability distribution (ex. <code>"GNO"</code>).</li>
</ul>
<p>Since our model has a nonstationary structure, three additional
arguments are required:</p>
<ul>
<li>
<code>ns_years</code>: The corresponding vector of years for the
observations in <code>data</code>.</li>
<li>
<code>ns_structure</code>: The nonstationary <code>structure</code>
object described above.</li>
<li>
<code>ns_slices</code>: The years at which return levels are
computed.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uncertainty_rfpl.html">uncertainty_rfpl</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">max</span>,</span>
<span>    <span class="st">"GNO"</span>,</span>
<span>    ns_years <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>    ns_structure <span class="op">=</span> <span class="va">ns_structure</span>,</span>
<span>    ns_slices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1915</span>, <span class="fl">2015</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_nsffa_estimates.html">plot_nsffa_estimates</a></span><span class="op">(</span><span class="va">fit</span>, ci_list <span class="op">=</span> <span class="va">uncertainty</span><span class="op">$</span><span class="va">ci_list</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-stationary-ffa_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><strong>Example Conclusion</strong>: In 2025, there is a <span class="math inline">\(1/20\)</span> exceedance probability of a flood of
approximately <span class="math inline">\(300\text{m}^3/\text{s}\)</span> or greater. The
estimated return levels have decreased by approximately <span class="math inline">\(50\text{m}^3/\text{s}\)</span> between 1925 and
2025.</p>
<p><strong>Note</strong>: Under nonstationarity, the return period
reflects the probability distribution for a fixed year rather than a
long-run average. To clarify this difference from stationary FFA, the
phrase “effective return period” is used.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Riley Wheadon, Cuauhtémoc Vidrio-Sahagún, Alain Pietroniro, Jianxun He, Environment and Climate Change Canada (ECCC).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
