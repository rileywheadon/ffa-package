<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Wrapper Functions for Framework Orchestration • ffaframework</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Wrapper Functions for Framework Orchestration">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffaframework</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/trend-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/trend-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/stationary-ffa.html">Stationary FFA</a></li>
    <li><a class="dropdown-item" href="../articles/non-stationary-ffa.html">Nonstationary FFA</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/wrapper-functions.html">Using Wrapper Functions</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-wiki" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Wiki</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-wiki">
<li><h6 class="dropdown-header" data-toc-skip>EDA</h6></li>
    <li><a class="dropdown-item" href="../articles/eda-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/eda-change-points.html">Change Points</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-mean.html">Trends in AMS Mean</a></li>
    <li><a class="dropdown-item" href="../articles/eda-trend-ams-variability.html">Trends in AMS Variability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FFA</h6></li>
    <li><a class="dropdown-item" href="../articles/ffa-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-probability-distributions.html">Probability Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-model-selection.html">Model Selection</a></li>
    <li><a class="dropdown-item" href="../articles/parameter-estimation.html">Parameter Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-uncertainty-quantification.html">Uncertainty Quantification</a></li>
    <li><a class="dropdown-item" href="../articles/ffa-model-assessment.html">Model Assessment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/matlab-version.html">MATLAB Version</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rileywheadon/ffa-framework/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Wrapper Functions for Framework Orchestration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rileywheadon/ffa-framework/blob/master/vignettes/wrapper-functions.Rmd" class="external-link"><code>vignettes/wrapper-functions.Rmd</code></a></small>
      <div class="d-none name"><code>wrapper-functions.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates how to use the high-level wrapper
functions <code>framework_eda</code>, <code>framework_ffa</code>, and
<code>framework_full</code> to perform a complete flood frequency
analysis of a dataset under the assumption of nonstationarity. Readers
unfamiliar with the FFA framework should first consult the other
vignettes.</p>
<div class="section level2">
<h2 id="case-study">Case Study<a class="anchor" aria-label="anchor" href="#case-study"></a>
</h2>
<p>This vignette will explore data from the Bow River at Banff
(05BB001), a station in the Reference Hydrometric Basin Network. The
station is unregulated and undeveloped, which suggests that trends in
annual maxima are caused by changes in climate as opposed to changes in
land use or cover. Data for this station is provided as
<code>CAN-05BB001.csv</code> in the <code>ffaframework</code>
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rileywheadon.github.io/ffa-framework/" class="external-link">ffaframework</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_local.html">data_local</a></span><span class="op">(</span><span class="st">"CAN-05BB001.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year max</span></span>
<span><span class="co">#&gt; 1 1909 314</span></span>
<span><span class="co">#&gt; 2 1910 230</span></span>
<span><span class="co">#&gt; 3 1911 264</span></span>
<span><span class="co">#&gt; 4 1912 174</span></span>
<span><span class="co">#&gt; 5 1913 232</span></span>
<span><span class="co">#&gt; 6 1914 214</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_ams_data.html">plot_ams_data</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">max</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span>, title <span class="op">=</span> <span class="st">"Bow River at Banff (05BB001)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrapper-functions_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="exploratory-data-analysis-with-framework_eda">Exploratory Data Analysis with <code>framework_eda</code><a class="anchor" aria-label="anchor" href="#exploratory-data-analysis-with-framework_eda"></a>
</h2>
<p>Exploratory data analysis, the first module in the FFA framework,
identifies change points and nonstationary trends in the data. The
entire module is orchestrated by the <code>framework_eda</code> wrapper
function, which takes the following arguments:</p>
<ul>
<li>
<code>data</code>: The annual maximum series observations.</li>
<li>
<code>years</code>: The corresponding vector of years.</li>
<li>
<code>ns_splits</code>: A list of years used to split the data prior
to trend detection.</li>
<li>
<code>generate_report</code>: If <code>TRUE</code>, a report will be
generated based on <code>report_path</code> and
<code>report_formats</code>.</li>
<li>
<code>report_path</code>: The directory where the report will be
saved.</li>
<li>
<code>report_formats</code>: A list of file formats
(<code>"md"</code>, <code>"pdf"</code>, <code>"json"</code>, or
<code>"html"</code>) for the report.</li>
</ul>
<p>The <code>framework_eda</code> function also returns a list of
recommendations, including an approach (either S-FFA, NS-FFA, or
piecewise NS-FFA), a list of split points, and a list of nonstationary
structures.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/framework_eda.html">framework_eda</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">max</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span>, generate_report <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">eda_recommendations</span><span class="op">)</span></span>
<span><span class="co">#&gt; $approach</span></span>
<span><span class="co">#&gt; [1] "Piecewise NS-FFA"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ns_splits</span></span>
<span><span class="co">#&gt; [1] 1974</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ns_structures</span></span>
<span><span class="co">#&gt; $ns_structures[[1]]</span></span>
<span><span class="co">#&gt; $ns_structures[[1]]$location</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ns_structures[[1]]$scale</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>From the <code>eda_recommendations</code> item, we can see that the
FFA framework recommends a split point in 1974. Since we did not use the
<code>ns_splits</code> argument, trend detection was run on the complete
time series. A monotonic trend in the location was identified over this
period.</p>
<div class="section level3">
<h3 id="selecting-split-points">Selecting Split Point(s)<a class="anchor" aria-label="anchor" href="#selecting-split-points"></a>
</h3>
<p>The change point detection vignette discussed multiple criteria for
selecting a split point. The first and most important criteria is that
there is a physical justification for the split point. For this case
study, there is no physical justification for a split point since the
basin is unregulated.</p>
<p>However, in cases where we have less information, it is often useful
to investigate the results of the Pettitt and MKS tests more carefully.
The <code>framework_eda</code> function allows us to do this by (a)
reading the report, or (b) using the <code>submodule_results</code>
object. The <code>submodule_results</code> object is a list with two
elements: the results of change point detection and the results of trend
detection.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pettitt_results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">submodule_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tests</span><span class="op">$</span><span class="va">pettitt</span></span>
<span><span class="va">mks_results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">submodule_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tests</span><span class="op">$</span><span class="va">mks</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_pettitt_test.html">plot_pettitt_test</a></span><span class="op">(</span><span class="va">pettitt_results</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrapper-functions_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mks_test.html">plot_mks_test</a></span><span class="op">(</span><span class="va">mks_results</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrapper-functions_files/figure-html/unnamed-chunk-4-2.png" width="100%" style="display: block; margin: auto;"></p>
<p>From these plots, we can see that the change point in 1974 was
identified by the Pettitt test, and that this change point is barely
above the significance threshold.</p>
</div>
</div>
<div class="section level2">
<h2 id="flood-frequency-analysis-with-framework_full">Flood Frequency Analysis with <code>framework_full</code><a class="anchor" aria-label="anchor" href="#flood-frequency-analysis-with-framework_full"></a>
</h2>
<p>Using the results of EDA and our knowledge of the station, it is
clear that a nonstationary approach with no split points and a trend in
the location parameter is the best model for this dataset. To perform
FFA, we can either use the <code>framework_ffa</code> function (which
will <em>only</em> perform FFA) or the <code>framework_full</code>
method (which will perform <em>both</em> EDA and FFA). Both functions
take the same arguments as the <code>framework_eda</code> function, with
the addition of <code>ns_structures</code>, which specifies the
nonstationary model structure for each homogeneous subperiod. In this
case, we have decided not to split the data, so
<code>ns_structures</code> will consist of a single list describing the
model structure for the entire time series.</p>
<p>This vignette will use the <code>framework_full</code> wrapper
function to run the complete FFA framework and generate a report. The
<code>framework_full</code> wrapper function returns a list with the
following three items:</p>
<ul>
<li>
<code>eda_recommendations</code>: The recommended approach, split
points, and model structures from EDA.</li>
<li>
<code>modelling_approach</code>: The approach, split points, and
model structures used for FFA.</li>
<li>
<code>submodule_results</code>: The results of EDA (change point
detection and trend detection) and FFA (distribution selection,
parameter estimation, uncertainty quantification, and model
assessment).</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/framework_full.html">framework_full</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">max</span>,</span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>    ns_splits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    ns_structures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    generate_report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    report_path <span class="op">=</span> <span class="st">"~"</span>,</span>
<span>    report_formats <span class="op">=</span> <span class="st">"html"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: The code snippet shown above was run outside
of the vignette environment to reduce compilation time. The resulting
report can be found <a href="https://rileywheadon.github.io/ffa-framework/example-report.html" class="external-link">here</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Riley Wheadon, Cuauhtémoc Vidrio-Sahagún, Alain Pietroniro, Jianxun He, Environment and Climate Change Canada (ECCC).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
